

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ethereum Simulations &mdash; The EVM Jello Paper 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex/"/>
        <link rel="search" title="Search" href="../search/"/>
    <link rel="top" title="The EVM Jello Paper 0.1 documentation" href="../"/>
        <link rel="next" title="KEVM Verification" href="../verification/"/>
        <link rel="prev" title="EVM Execution" href="../evm/"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../" class="icon icon-home"> The EVM Jello Paper
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../evm/">EVM Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#evm-programs">EVM Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#precompiled-contracts">Precompiled Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#ethereum-gas-calculation">Ethereum Gas Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#evm-program-representations">EVM Program Representations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ethereum Simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#state-manipulation">State Manipulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../verification/">KEVM Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/">EVM Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#data-structures">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#parsing-unparsing">Parsing/Unparsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#recursive-length-prefix-rlp">Recursive Length Prefix (RLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/">Analysis Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../krypto/">Cryptographic Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/">EVM Design Issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">The EVM Jello Paper</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../">Docs</a> &raquo;</li>
        
      <li>Ethereum Simulations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ethereum.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ethereum-simulations">
<h1>Ethereum Simulations<a class="headerlink" href="#ethereum-simulations" title="Permalink to this headline">¶</a></h1>
<p>Ethereum is using the EVM to drive updates over the world state.
Actual execution of the EVM is defined in [the EVM file](evm.md).</p>
<p><code class="docutils literal"><span class="pre">`{.k</span> <span class="pre">.uiuck}</span>
<span class="pre">requires</span> <span class="pre">&quot;verification.k&quot;</span>
<span class="pre">`</span></code></p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>{.k .uiuck .rvk}
requires “evm.k”
requires “analysis.k”</p>
<dl class="docutils">
<dt>module ETHEREUM-SIMULATION</dt>
<dd>imports EVM
imports EVM-ANALYSIS</dd>
</dl>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<dl class="docutils">
<dt><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>{.k .uiuck}</dt>
<dd>imports VERIFICATION</dd>
</dl>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<dl class="docutils">
<dt><a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>{.k .rvk}</dt>
<dd>imports K-REFLECTION</dd>
</dl>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a></p>
<p>An Ethereum simulation is a list of Ethereum commands.
Some Ethereum commands take an Ethereum specification (eg. for an account or transaction).</p>
<dl class="docutils">
<dt><a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>syntax EthereumSimulation ::= “.EthereumSimulation”</dt>
<dd><div class="first last line-block">
<div class="line">EthereumCommand EthereumSimulation</div>
</div>
</dd>
</dl>
</div></blockquote>
<dl class="last docutils">
<dt>// —————————————————————-</dt>
<dd><p class="first">rule .EthereumSimulation =&gt; .
rule ETC:EthereumCommand ETS:EthereumSimulation =&gt; ETC ~&gt; ETS</p>
<p class="last">syntax EthereumSimulation ::= JSON</p>
</dd>
<dt>// ———————————-</dt>
<dd>rule &lt;k&gt; JSONINPUT:JSON =&gt; run JSONINPUT success .EthereumSimulation &lt;/k&gt;</dd>
</dl>
</dd>
</dl>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p>For verification purposes, it’s much easier to specify a program in terms of its op-codes and not the hex-encoding that the tests use.
To do so, we’ll extend sort <cite>JSON</cite> with some EVM specific syntax, and provide a “pretti-fication” to the nicer input form.</p>
<dl class="docutils">
<dt><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax JSON ::= Int | WordStack | OpCodes | Map | Call | SubstateLogEntry | Account</div></blockquote>
<p>// ———————————————————————————–</p>
<blockquote>
<div><dl class="docutils">
<dt>syntax JSONList ::= #sortJSONList ( JSONList )            [function]</dt>
<dd><div class="first last line-block">
<div class="line">#sortJSONList ( JSONList , JSONList ) [function, klabel(#sortJSONListAux)]</div>
</div>
</dd>
</dl>
</div></blockquote>
<dl class="last docutils">
<dt>// ———————————————————————————————-</dt>
<dd><p class="first">rule #sortJSONList(JS) =&gt; #sortJSONList(JS, .JSONList)
rule #sortJSONList(.JSONList, LS)            =&gt; LS
rule #sortJSONList(((KEY : VAL) , REST), LS) =&gt; #insertJSONKey((KEY : VAL), #sortJSONList(REST, LS))</p>
<p class="last">syntax JSONList ::= #insertJSONKey ( JSON , JSONList ) [function]</p>
</dd>
<dt>// —————————————————————–</dt>
<dd><p class="first">rule #insertJSONKey( JS , .JSONList ) =&gt; JS , .JSONList
rule #insertJSONKey( (KEY : VAL) , ((KEY’ : VAL’) , REST) ) =&gt; (KEY : VAL)   , (KEY’ : VAL’)              , REST  requires KEY &lt;String KEY’
rule #insertJSONKey( (KEY : VAL) , ((KEY’ : VAL’) , REST) ) =&gt; (KEY’ : VAL’) , #insertJSONKey((KEY : VAL) , REST) requires KEY &gt;=String KEY’</p>
<p class="last">syntax Bool ::= #isSorted ( JSONList ) [function]</p>
</dd>
<dt>// ————————————————-</dt>
<dd>rule #isSorted( .JSONList ) =&gt; true
rule #isSorted( KEY : _ )   =&gt; true
rule #isSorted( (KEY : _) , (KEY’ : VAL) , REST ) =&gt; KEY &lt;=String KEY’ andThenBool #isSorted((KEY’ : VAL) , REST)</dd>
</dl>
</dd>
</dl>
<p><a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a></p>
<p>### Driving Execution</p>
<ul class="simple">
<li><cite>start</cite> places <cite>#next</cite> on the <cite>&lt;k&gt;</cite> cell so that execution of the loaded state begin.</li>
<li><cite>flush</cite> places <cite>#finalize</cite> on the <cite>&lt;k&gt;</cite> cell once it sees <cite>#end</cite> in the <cite>&lt;k&gt;</cite> cell, clearing any exceptions it finds.</li>
</ul>
<dl class="docutils">
<dt><a href="#id41"><span class="problematic" id="id42">``</span></a><a href="#id43"><span class="problematic" id="id44">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “start”</div></blockquote>
<dl class="last docutils">
<dt>// ———————————-</dt>
<dd><p class="first">rule &lt;mode&gt; NORMAL     &lt;/mode&gt; &lt;k&gt; start =&gt; #execute    … &lt;/k&gt;
rule &lt;mode&gt; VMTESTS    &lt;/mode&gt; &lt;k&gt; start =&gt; #execute    … &lt;/k&gt;
rule &lt;mode&gt; GASANALYZE &lt;/mode&gt; &lt;k&gt; start =&gt; #gasAnalyze … &lt;/k&gt;</p>
<p class="last">syntax EthereumCommand ::= “flush”</p>
</dd>
<dt>// ———————————-</dt>
<dd>rule &lt;k&gt; #end       ~&gt; flush =&gt; #finalizeTx(false)               … &lt;/k&gt;
rule &lt;k&gt; #exception ~&gt; flush =&gt; #finalizeTx(false) ~&gt; #exception … &lt;/k&gt;</dd>
</dl>
</dd>
</dl>
<p><a href="#id45"><span class="problematic" id="id46">``</span></a><a href="#id47"><span class="problematic" id="id48">`</span></a></p>
<ul class="simple">
<li><cite>startTx</cite> computes the sender of the transaction, and places loadTx on the <cite>k</cite> cell.</li>
<li><cite>loadTx(_)</cite> loads the next transaction to be executed into the current state.</li>
<li><cite>finishTx</cite> is a place-holder for performing necessary cleanup after a transaction.</li>
</ul>
<dl class="docutils">
<dt><a href="#id49"><span class="problematic" id="id50">``</span></a><a href="#id51"><span class="problematic" id="id52">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “startTx”</div></blockquote>
<dl class="last docutils">
<dt>// ————————————</dt>
<dd><dl class="first docutils">
<dt>rule &lt;k&gt; startTx =&gt; #finalizeBlock … &lt;/k&gt;</dt>
<dd>&lt;txPending&gt; .List &lt;/txPending&gt;</dd>
<dt>rule &lt;k&gt; startTx =&gt; loadTx(#sender(TN, TP, TG, TT, TV, #unparseByteStack(DATA), TW, TR, TS)) … &lt;/k&gt;</dt>
<dd><p class="first">&lt;txPending&gt; ListItem(TXID:Int) … &lt;/txPending&gt;
&lt;message&gt;</p>
<blockquote>
<div>&lt;msgID&gt;      TXID &lt;/msgID&gt;
&lt;txNonce&gt;    TN   &lt;/txNonce&gt;
&lt;txGasPrice&gt; TP   &lt;/txGasPrice&gt;
&lt;txGasLimit&gt; TG   &lt;/txGasLimit&gt;
&lt;to&gt;         TT   &lt;/to&gt;
&lt;value&gt;      TV   &lt;/value&gt;
&lt;v&gt;          TW   &lt;/v&gt;
&lt;r&gt;          TR   &lt;/r&gt;
&lt;s&gt;          TS   &lt;/s&gt;
&lt;data&gt;       DATA &lt;/data&gt;</div></blockquote>
<p class="last">&lt;/message&gt;</p>
</dd>
</dl>
<p class="last">syntax EthereumCommand ::= loadTx ( Int )</p>
</dd>
<dt>// —————————————–</dt>
<dd><dl class="first docutils">
<dt>rule &lt;k&gt; loadTx(ACCTFROM)</dt>
<dd><blockquote class="first">
<div>=&gt; #create ACCTFROM #newAddr(ACCTFROM, NONCE) (GLIMIT -Int G0(SCHED, CODE, true)) VALUE CODE
~&gt; #execute ~&gt; #finishTx ~&gt; #finalizeTx(false) ~&gt; startTx</div></blockquote>
<p>…
&lt;/k&gt;
&lt;schedule&gt; SCHED &lt;/schedule&gt;
&lt;gasPrice&gt; _ =&gt; GPRICE &lt;/gasPrice&gt;
&lt;origin&gt; _ =&gt; ACCTFROM &lt;/origin&gt;
&lt;callDepth&gt; _ =&gt; -1 &lt;/callDepth&gt;
&lt;txPending&gt; ListItem(TXID:Int) … &lt;/txPending&gt;
&lt;message&gt;</p>
<blockquote>
<div>&lt;msgID&gt;      TXID     &lt;/msgID&gt;
&lt;txGasPrice&gt; GPRICE   &lt;/txGasPrice&gt;
&lt;txGasLimit&gt; GLIMIT   &lt;/txGasLimit&gt;
&lt;to&gt;         .Account &lt;/to&gt;
&lt;value&gt;      VALUE    &lt;/value&gt;
&lt;data&gt;       CODE     &lt;/data&gt;
…</div></blockquote>
<p>&lt;/message&gt;
&lt;account&gt;</p>
<blockquote>
<div>&lt;acctID&gt; ACCTFROM &lt;/acctID&gt;
&lt;balance&gt; BAL =&gt; BAL -Int (GLIMIT <a href="#id53"><span class="problematic" id="id54">*</span></a>Int GPRICE) &lt;/balance&gt;
&lt;nonce&gt; NONCE =&gt; NONCE +Int 1 &lt;/nonce&gt;
…</div></blockquote>
<p class="last">&lt;/account&gt;
&lt;activeAccounts&gt; … ACCTFROM <a href="#id55"><span class="problematic" id="id56">|</span></a>-&gt; (_ =&gt; false) … &lt;/activeAccounts&gt;</p>
</dd>
<dt>rule &lt;k&gt; loadTx(ACCTFROM)</dt>
<dd><blockquote class="first">
<div><blockquote>
<div>=&gt; #call ACCTFROM ACCTTO ACCTTO (GLIMIT -Int G0(SCHED, DATA, false)) VALUE VALUE DATA
~&gt; #execute ~&gt; #finishTx ~&gt; #finalizeTx(false) ~&gt; startTx</div></blockquote>
<p>…
&lt;/k&gt;
&lt;schedule&gt; SCHED &lt;/schedule&gt;
&lt;gasPrice&gt; _ =&gt; GPRICE &lt;/gasPrice&gt;
&lt;origin&gt; _ =&gt; ACCTFROM &lt;/origin&gt;
&lt;callDepth&gt; _ =&gt; -1 &lt;/callDepth&gt;
&lt;txPending&gt; ListItem(TXID:Int) … &lt;/txPending&gt;
&lt;message&gt;</p>
<blockquote>
<div>&lt;msgID&gt;      TXID   &lt;/msgID&gt;
&lt;txGasPrice&gt; GPRICE &lt;/txGasPrice&gt;
&lt;txGasLimit&gt; GLIMIT &lt;/txGasLimit&gt;
&lt;to&gt;         ACCTTO &lt;/to&gt;
&lt;value&gt;      VALUE  &lt;/value&gt;
&lt;data&gt;       DATA   &lt;/data&gt;
…</div></blockquote>
<p>&lt;/message&gt;
&lt;account&gt;</p>
<blockquote>
<div>&lt;acctID&gt; ACCTFROM &lt;/acctID&gt;
&lt;balance&gt; BAL =&gt; BAL -Int (GLIMIT <a href="#id57"><span class="problematic" id="id58">*</span></a>Int GPRICE) &lt;/balance&gt;
&lt;nonce&gt; NONCE =&gt; NONCE +Int 1 &lt;/nonce&gt;
…</div></blockquote>
<p>&lt;/account&gt;
&lt;activeAccounts&gt; … ACCTFROM <a href="#id59"><span class="problematic" id="id60">|</span></a>-&gt; (_ =&gt; false) … &lt;/activeAccounts&gt;</p>
</div></blockquote>
<p class="last">requires ACCTTO =/=K .Account</p>
</dd>
</dl>
<p class="last">syntax EthereumCommand ::= “#finishTx”</p>
</dd>
<dt>// ————————————–</dt>
<dd><p class="first">rule &lt;k&gt; #exception ~&gt; #finishTx =&gt; #popCallStack ~&gt; #popWorldState ~&gt; #popSubstate … &lt;/k&gt;</p>
<dl class="last docutils">
<dt>rule &lt;k&gt; #end ~&gt; #finishTx =&gt; #mkCodeDeposit ACCT … &lt;/k&gt;</dt>
<dd><p class="first">&lt;id&gt; ACCT &lt;/id&gt;
&lt;txPending&gt; ListItem(TXID:Int) … &lt;/txPending&gt;
&lt;message&gt;</p>
<blockquote>
<div>&lt;msgID&gt; TXID     &lt;/msgID&gt;
&lt;to&gt;    .Account &lt;/to&gt;
…</div></blockquote>
<p class="last">&lt;/message&gt;</p>
</dd>
<dt>rule &lt;k&gt; #end ~&gt; #finishTx =&gt; #popCallStack ~&gt; #dropWorldState ~&gt; #dropSubstate ~&gt; #refund GAVAIL … &lt;/k&gt;</dt>
<dd><blockquote class="first">
<div><p>&lt;id&gt; ACCT &lt;/id&gt;
&lt;gas&gt; GAVAIL &lt;/gas&gt;
&lt;txPending&gt; ListItem(TXID:Int) … &lt;/txPending&gt;
&lt;message&gt;</p>
<blockquote>
<div>&lt;msgID&gt; TXID &lt;/msgID&gt;
&lt;to&gt;    TT   &lt;/to&gt;
…</div></blockquote>
<p>&lt;/message&gt;</p>
</div></blockquote>
<p class="last">requires TT =/=K .Account</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id61"><span class="problematic" id="id62">``</span></a><a href="#id63"><span class="problematic" id="id64">`</span></a></p>
<ul class="simple">
<li><cite>#finalizeBlock</cite> is used to signal that block finalization procedures should take place (after transactions have executed).</li>
<li><cite>#rewardOmmers(_)</cite> pays out the reward to uncle blocks so that blocks are orphaned less often in Ethereum.</li>
</ul>
<dl class="docutils">
<dt><a href="#id65"><span class="problematic" id="id66">``</span></a><a href="#id67"><span class="problematic" id="id68">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “#finalizeBlock” | #rewardOmmers ( JSONList )</div></blockquote>
<dl class="last docutils">
<dt>// ————————————————————————</dt>
<dd><dl class="first docutils">
<dt>rule &lt;k&gt; #finalizeBlock =&gt; #rewardOmmers(OMMERS) … &lt;/k&gt;</dt>
<dd><p class="first">&lt;ommerBlockHeaders&gt; [ OMMERS ] &lt;/ommerBlockHeaders&gt;
&lt;coinbase&gt; MINER &lt;/coinbase&gt;
&lt;account&gt;</p>
<blockquote>
<div>&lt;acctID&gt; MINER &lt;/acctID&gt;
&lt;balance&gt; MINBAL =&gt; MINBAL +Int Rb &lt;/balance&gt;
…</div></blockquote>
<p class="last">&lt;/account&gt;
&lt;activeAccounts&gt; … MINER <a href="#id69"><span class="problematic" id="id70">|</span></a>-&gt; (_ =&gt; false) … &lt;/activeAccounts&gt;</p>
</dd>
<dt>rule &lt;k&gt; (.K =&gt; #newAccount MINER) ~&gt; #finalizeBlock … &lt;/k&gt;</dt>
<dd><blockquote class="first">
<div>&lt;coinbase&gt; MINER &lt;/coinbase&gt;
&lt;activeAccounts&gt; ACCTS &lt;/activeAccounts&gt;</div></blockquote>
<p class="last">requires notBool MINER in_keys(ACCTS)</p>
</dd>
</dl>
<p>rule &lt;k&gt; #rewardOmmers(.JSONList) =&gt; . … &lt;/k&gt;
rule &lt;k&gt; #rewardOmmers([ _ , _ , OMMER , _ , _ , _ , _ , _ , OMMNUM , _ ] , REST) =&gt; #rewardOmmers(REST) … &lt;/k&gt;</p>
<blockquote>
<div><p>&lt;coinbase&gt; MINER &lt;/coinbase&gt;
&lt;number&gt; CURNUM &lt;/number&gt;
&lt;account&gt;</p>
<blockquote>
<div><blockquote>
<div>&lt;acctID&gt; MINER &lt;/acctID&gt;
&lt;balance&gt; MINBAL =&gt; MINBAL +Int Rb /Int 32 &lt;/balance&gt;</div></blockquote>
<p>…</p>
</div></blockquote>
<p>&lt;/account&gt;
&lt;account&gt;</p>
<blockquote>
<div><blockquote>
<div>&lt;acctID&gt; OMMER &lt;/acctID&gt;
&lt;balance&gt; OMMBAL =&gt; OMMBAL +Int Rb +Int (OMMNUM -Int CURNUM) <a href="#id71"><span class="problematic" id="id72">*</span></a>Int (Rb /Int 8) &lt;/balance&gt;</div></blockquote>
<p>…</p>
</div></blockquote>
<p>&lt;/account&gt;
&lt;activeAccounts&gt; … MINER <a href="#id73"><span class="problematic" id="id74">|</span></a>-&gt; (_ =&gt; false) OMMER <a href="#id75"><span class="problematic" id="id76">|</span></a>-&gt; (_ =&gt; false) … &lt;/activeAccounts&gt;</p>
</div></blockquote>
<p class="last">syntax Int ::= “Rb” [function]</p>
</dd>
<dt>// ——————————</dt>
<dd>rule Rb =&gt; 5 <a href="#id77"><span class="problematic" id="id78">*</span></a>Int (10 ^Int 18)</dd>
</dl>
</dd>
</dl>
<p><a href="#id79"><span class="problematic" id="id80">``</span></a><a href="#id81"><span class="problematic" id="id82">`</span></a></p>
<ul class="simple">
<li><cite>exception</cite> only clears from the <cite>&lt;k&gt;</cite> cell if there is an exception preceding it.</li>
<li><cite>failure_</cite> holds the name of a test that failed if a test does fail.</li>
</ul>
<dl class="docutils">
<dt><a href="#id83"><span class="problematic" id="id84">``</span></a><a href="#id85"><span class="problematic" id="id86">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “exception” | “failure” String | “success”</div></blockquote>
<dl class="last docutils">
<dt>// ———————————————————————</dt>
<dd>rule &lt;k&gt; #exception ~&gt; exception =&gt; . … &lt;/k&gt;
rule &lt;k&gt; success =&gt; . … &lt;/k&gt; &lt;exit-code&gt; _ =&gt; 0 &lt;/exit-code&gt;
rule failure _ =&gt; .</dd>
</dl>
</dd>
</dl>
<p><a href="#id87"><span class="problematic" id="id88">``</span></a><a href="#id89"><span class="problematic" id="id90">`</span></a></p>
<p>### Running Tests</p>
<ul class="simple">
<li><cite>run</cite> runs a given set of Ethereum tests (from the test-set).</li>
</ul>
<p>Note that <cite>TEST</cite> is sorted here so that key <cite>“network”</cite> comes before key <cite>“pre”</cite>.</p>
<dl class="docutils">
<dt><a href="#id91"><span class="problematic" id="id92">``</span></a><a href="#id93"><span class="problematic" id="id94">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “run” JSON</div></blockquote>
<dl class="last docutils">
<dt>// ————————————-</dt>
<dd><p class="first">rule run { .JSONList } =&gt; .
rule run { TESTID : { TEST:JSONList } , TESTS }</p>
<blockquote>
<div>=&gt; run ( TESTID : { #sortJSONList(TEST) } )
~&gt; #if #hasPost?( { TEST } ) #then .K #else exception #fi
~&gt; clear
~&gt; run { TESTS }</div></blockquote>
<p class="last">syntax Bool ::= “#hasPost?” “(” JSON “)” [function]</p>
</dd>
<dt>// —————————————————</dt>
<dd>rule #hasPost? ({ .JSONList }) =&gt; false
rule #hasPost? ({ (KEY:String) : _ , REST }) =&gt; (KEY in #postKeys) orBool #hasPost? ({ REST })</dd>
</dl>
</dd>
</dl>
<p><a href="#id95"><span class="problematic" id="id96">``</span></a><a href="#id97"><span class="problematic" id="id98">`</span></a></p>
<ul class="simple">
<li><cite>#loadKeys</cite> are all the JSON nodes which should be considered as loads before execution.</li>
</ul>
<dl class="docutils">
<dt><a href="#id99"><span class="problematic" id="id100">``</span></a><a href="#id101"><span class="problematic" id="id102">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax Set ::= “#loadKeys” [function]</div></blockquote>
<dl class="last docutils">
<dt>// ————————————-</dt>
<dd><p class="first">rule #loadKeys =&gt; ( SetItem(“env”) SetItem(“pre”) SetItem(“rlp”) SetItem(“network”) SetItem(“genesisRLP”) )</p>
<p>rule run TESTID : { KEY : (VAL:JSON) , REST } =&gt; load KEY : VAL ~&gt; run TESTID : { REST } requires KEY in #loadKeys</p>
<p class="last">rule run TESTID : { “blocks” : [ { KEY : VAL , REST1 =&gt; REST1 }, .JSONList ] , ( REST2 =&gt; KEY : VAL , REST2 ) }
rule run TESTID : { “blocks” : [ { .JSONList }, .JSONList ] , REST } =&gt; run TESTID : { REST }</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id103"><span class="problematic" id="id104">``</span></a><a href="#id105"><span class="problematic" id="id106">`</span></a></p>
<ul class="simple">
<li><cite>#execKeys</cite> are all the JSON nodes which should be considered for execution (between loading and checking).</li>
</ul>
<dl class="docutils">
<dt><a href="#id107"><span class="problematic" id="id108">``</span></a><a href="#id109"><span class="problematic" id="id110">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax Set ::= “#execKeys” [function]</div></blockquote>
<dl class="last docutils">
<dt>// ————————————-</dt>
<dd><p class="first">rule #execKeys =&gt; ( SetItem(“exec”) SetItem(“lastblockhash”) )</p>
<p>rule run TESTID : { KEY : (VAL:JSON) , NEXT , REST } =&gt; run TESTID : { NEXT , KEY : VAL , REST } requires KEY in #execKeys</p>
<p class="last">rule run TESTID : { “exec” : (EXEC:JSON) } =&gt; load “exec” : EXEC ~&gt; start ~&gt; flush
rule run TESTID : { “lastblockhash” : (HASH:String) } =&gt; startTx</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id111"><span class="problematic" id="id112">``</span></a><a href="#id113"><span class="problematic" id="id114">`</span></a></p>
<ul class="simple">
<li><cite>#postKeys</cite> are a subset of <cite>#checkKeys</cite> which correspond to post-state account checks.</li>
<li><cite>#checkKeys</cite> are all the JSON nodes which should be considered as checks after execution.</li>
</ul>
<dl class="docutils">
<dt><a href="#id115"><span class="problematic" id="id116">``</span></a><a href="#id117"><span class="problematic" id="id118">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax Set ::= “#postKeys” [function] | “#allPostKeys” [function] | “#checkKeys” [function]</div></blockquote>
<dl class="last docutils">
<dt>// ——————————————————————————————-</dt>
<dd><p class="first">rule #postKeys    =&gt; ( SetItem(“post”) SetItem(“postState”) )
rule #allPostKeys =&gt; ( #postKeys SetItem(“expect”) SetItem(“export”) SetItem(“expet”) )
rule #checkKeys   =&gt; ( #allPostKeys SetItem(“logs”) SetItem(“callcreates”) SetItem(“out”) SetItem(“gas”)</p>
<blockquote>
<div><blockquote>
<div>SetItem(“blockHeader”) SetItem(“transactions”) SetItem(“uncleHeaders”) SetItem(“genesisBlockHeader”)</div></blockquote>
<p>)</p>
</div></blockquote>
<p class="last">rule run TESTID : { KEY : (VAL:JSON) , REST } =&gt; run TESTID : { REST } ~&gt; check TESTID : { “post” : VAL } requires KEY in #allPostKeys
rule run TESTID : { KEY : (VAL:JSON) , REST } =&gt; run TESTID : { REST } ~&gt; check TESTID : { KEY    : VAL } requires KEY in #checkKeys andBool notBool KEY in #allPostKeys</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id119"><span class="problematic" id="id120">``</span></a><a href="#id121"><span class="problematic" id="id122">`</span></a></p>
<ul class="simple">
<li><cite>#discardKeys</cite> are all the JSON nodes in the tests which should just be ignored.</li>
</ul>
<dl class="docutils">
<dt><a href="#id123"><span class="problematic" id="id124">``</span></a><a href="#id125"><span class="problematic" id="id126">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax Set ::= “#discardKeys” [function]</div></blockquote>
<dl class="last docutils">
<dt>// —————————————-</dt>
<dd><p class="first">rule #discardKeys =&gt; ( SetItem(“//”) SetItem(“_info”) )</p>
<p class="last">rule run TESTID : { KEY : _ , REST } =&gt; run TESTID : { REST } requires KEY in #discardKeys</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id127"><span class="problematic" id="id128">``</span></a><a href="#id129"><span class="problematic" id="id130">`</span></a></p>
<div class="section" id="state-manipulation">
<h2>State Manipulation<a class="headerlink" href="#state-manipulation" title="Permalink to this headline">¶</a></h2>
<p>### Clearing State</p>
<ul class="simple">
<li><cite>clear</cite> clears all the execution state of the machine.</li>
<li><cite>clearX</cite> clears the substate <cite>X</cite>, for <cite>TX</cite>, <cite>BLOCK</cite>, and <cite>NETWORK</cite>.</li>
</ul>
<dl class="docutils">
<dt><a href="#id131"><span class="problematic" id="id132">``</span></a><a href="#id133"><span class="problematic" id="id134">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “clear”</div></blockquote>
<dl class="last docutils">
<dt>// ———————————-</dt>
<dd><dl class="first docutils">
<dt>rule &lt;k&gt; clear =&gt; clearTX ~&gt; clearBLOCK ~&gt; clearNETWORK … &lt;/k&gt;</dt>
<dd>&lt;analysis&gt; _ =&gt; .Map &lt;/analysis&gt;</dd>
</dl>
<p class="last">syntax EthreumCommand ::= “clearTX”</p>
</dd>
<dt>// ———————————–</dt>
<dd><dl class="first docutils">
<dt>rule &lt;k&gt; clearTX =&gt; . … &lt;/k&gt;</dt>
<dd>&lt;output&gt;       _ =&gt; .WordStack &lt;/output&gt;
&lt;memoryUsed&gt;   _ =&gt; 0          &lt;/memoryUsed&gt;
&lt;callDepth&gt;    _ =&gt; 0          &lt;/callDepth&gt;
&lt;callStack&gt;    _ =&gt; .List      &lt;/callStack&gt;
&lt;callLog&gt;      _ =&gt; .Set       &lt;/callLog&gt;
&lt;program&gt;      _ =&gt; .Map       &lt;/program&gt;
&lt;programBytes&gt; _ =&gt; .WordStack &lt;/programBytes&gt;
&lt;id&gt;           _ =&gt; 0          &lt;/id&gt;
&lt;caller&gt;       _ =&gt; 0          &lt;/caller&gt;
&lt;callData&gt;     _ =&gt; .WordStack &lt;/callData&gt;
&lt;callValue&gt;    _ =&gt; 0          &lt;/callValue&gt;
&lt;wordStack&gt;    _ =&gt; .WordStack &lt;/wordStack&gt;
&lt;localMem&gt;     _ =&gt; .Map       &lt;/localMem&gt;
&lt;pc&gt;           _ =&gt; 0          &lt;/pc&gt;
&lt;gas&gt;          _ =&gt; 0          &lt;/gas&gt;
&lt;previousGas&gt;  _ =&gt; 0          &lt;/previousGas&gt;
&lt;selfDestruct&gt; _ =&gt; .Set       &lt;/selfDestruct&gt;
&lt;log&gt;          _ =&gt; .List      &lt;/log&gt;
&lt;refund&gt;       _ =&gt; 0          &lt;/refund&gt;
&lt;gasPrice&gt;     _ =&gt; 0          &lt;/gasPrice&gt;
&lt;origin&gt;       _ =&gt; 0          &lt;/origin&gt;</dd>
</dl>
<p class="last">syntax EthreumCommand ::= “clearBLOCK”</p>
</dd>
<dt>// ————————————–</dt>
<dd><dl class="first docutils">
<dt>rule &lt;k&gt; clearBLOCK =&gt; . … &lt;/k&gt;</dt>
<dd>&lt;previousHash&gt;      _ =&gt; 0             &lt;/previousHash&gt;
&lt;ommersHash&gt;        _ =&gt; 0             &lt;/ommersHash&gt;
&lt;coinbase&gt;          _ =&gt; 0             &lt;/coinbase&gt;
&lt;stateRoot&gt;         _ =&gt; 0             &lt;/stateRoot&gt;
&lt;transactionsRoot&gt;  _ =&gt; 0             &lt;/transactionsRoot&gt;
&lt;receiptsRoot&gt;      _ =&gt; 0             &lt;/receiptsRoot&gt;
&lt;logsBloom&gt;         _ =&gt; .WordStack    &lt;/logsBloom&gt;
&lt;difficulty&gt;        _ =&gt; 0             &lt;/difficulty&gt;
&lt;number&gt;            _ =&gt; 0             &lt;/number&gt;
&lt;gasLimit&gt;          _ =&gt; 0             &lt;/gasLimit&gt;
&lt;gasUsed&gt;           _ =&gt; 0             &lt;/gasUsed&gt;
&lt;timestamp&gt;         _ =&gt; 0             &lt;/timestamp&gt;
&lt;extraData&gt;         _ =&gt; .WordStack    &lt;/extraData&gt;
&lt;mixHash&gt;           _ =&gt; 0             &lt;/mixHash&gt;
&lt;blockNonce&gt;        _ =&gt; 0             &lt;/blockNonce&gt;
&lt;ommerBlockHeaders&gt; _ =&gt; [ .JSONList ] &lt;/ommerBlockHeaders&gt;
&lt;blockhash&gt;         _ =&gt; .List         &lt;/blockhash&gt;</dd>
</dl>
<p class="last">syntax EthreumCommand ::= “clearNETWORK”</p>
</dd>
<dt>// —————————————-</dt>
<dd><dl class="first last docutils">
<dt>rule &lt;k&gt; clearNETWORK =&gt; . … &lt;/k&gt;</dt>
<dd>&lt;activeAccounts&gt; _ =&gt; .Map    &lt;/activeAccounts&gt;
&lt;accounts&gt;       _ =&gt; .Bag    &lt;/accounts&gt;
&lt;messages&gt;       _ =&gt; .Bag    &lt;/messages&gt;
&lt;schedule&gt;       _ =&gt; DEFAULT &lt;/schedule&gt;</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id135"><span class="problematic" id="id136">``</span></a><a href="#id137"><span class="problematic" id="id138">`</span></a></p>
<p>### Loading State</p>
<ul class="simple">
<li><cite>mkAcct_</cite> creates an account with the supplied ID (assuming it’s already been chopped to 160 bits).</li>
</ul>
<dl class="docutils">
<dt><a href="#id139"><span class="problematic" id="id140">``</span></a><a href="#id141"><span class="problematic" id="id142">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “mkAcct” Int</div></blockquote>
<dl class="last docutils">
<dt>// —————————————</dt>
<dd>rule &lt;k&gt; mkAcct ACCT =&gt; #newAccount ACCT … &lt;/k&gt;</dd>
</dl>
</dd>
</dl>
<p><a href="#id143"><span class="problematic" id="id144">``</span></a><a href="#id145"><span class="problematic" id="id146">`</span></a></p>
<ul class="simple">
<li><cite>load</cite> loads an account or transaction into the world state.</li>
</ul>
<dl class="docutils">
<dt><a href="#id147"><span class="problematic" id="id148">``</span></a><a href="#id149"><span class="problematic" id="id150">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “load” JSON</div></blockquote>
<dl class="last docutils">
<dt>// ————————————–</dt>
<dd><p class="first">rule load DATA : { .JSONList } =&gt; .
rule load DATA : { KEY : VALUE , REST } =&gt; load DATA : { KEY : VALUE } ~&gt; load DATA : { REST }</p>
<blockquote>
<div>requires REST =/=K .JSONList andBool DATA =/=String “transaction”</div></blockquote>
<p class="last">rule load DATA : [ .JSONList ] =&gt; .
rule load DATA : [ { TEST } , REST ] =&gt; load DATA : { TEST } ~&gt; load DATA : [ REST ]</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id151"><span class="problematic" id="id152">``</span></a><a href="#id153"><span class="problematic" id="id154">`</span></a></p>
<p>Here we perform pre-proccesing on account data which allows “pretty” specification of input.</p>
<dl class="docutils">
<dt><a href="#id155"><span class="problematic" id="id156">``</span></a><a href="#id157"><span class="problematic" id="id158">`</span></a>{.k .uiuck .rvk}</dt>
<dd><p class="first">rule load “pre” : { (ACCTID:String) : ACCT } =&gt; mkAcct #parseAddr(ACCTID) ~&gt; load “account” : { ACCTID : ACCT }
rule load “account” : { ACCTID: { KEY : VALUE , REST } } =&gt; load “account” : { ACCTID : { KEY : VALUE } } ~&gt; load “account” : { ACCTID : { REST } } requires REST =/=K .JSONList</p>
<p class="last">rule load “account” : { ((ACCTID:String) =&gt; #parseAddr(ACCTID)) : ACCT }
rule load “account” : { (ACCT:Int) : { “balance” : ((VAL:String)         =&gt; #parseWord(VAL)) } }
rule load “account” : { (ACCT:Int) : { “nonce”   : ((VAL:String)         =&gt; #parseWord(VAL)) } }
rule load “account” : { (ACCT:Int) : { “code”    : ((CODE:String)        =&gt; #parseByteStack(CODE)) } }
rule load “account” : { (ACCT:Int) : { “storage” : ({ STORAGE:JSONList } =&gt; #parseMap({ STORAGE })) } }</p>
</dd>
</dl>
<p><a href="#id159"><span class="problematic" id="id160">``</span></a><a href="#id161"><span class="problematic" id="id162">`</span></a></p>
<p>The individual fields of the accounts are dealt with here.</p>
<dl class="docutils">
<dt><a href="#id163"><span class="problematic" id="id164">``</span></a><a href="#id165"><span class="problematic" id="id166">`</span></a>{.k .uiuck .rvk}</dt>
<dd><dl class="first last docutils">
<dt>rule &lt;k&gt; load “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “balance”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(BAL:Int) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><dl class="first docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;balance&gt; _ =&gt; BAL &lt;/balance&gt;
…</dd>
</dl>
<p class="last">&lt;/account&gt;
&lt;activeAccounts&gt; … ACCT <a href="#id167"><span class="problematic" id="id168">|</span></a>-&gt; (EMPTY =&gt; #if BAL =/=Int 0 #then false #else EMPTY #fi) … &lt;/activeAccounts&gt;</p>
</dd>
<dt>rule &lt;k&gt; load “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “code”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(CODE:WordStack) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><dl class="first docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;code&gt; _ =&gt; CODE &lt;/code&gt;
…</dd>
</dl>
<p class="last">&lt;/account&gt;
&lt;activeAccounts&gt; … ACCT <a href="#id169"><span class="problematic" id="id170">|</span></a>-&gt; (EMPTY =&gt; #if CODE =/=K .WordStack #then false #else EMPTY #fi) … &lt;/activeAccounts&gt;</p>
</dd>
<dt>rule &lt;k&gt; load “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “nonce”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(NONCE:Int) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><dl class="first docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;nonce&gt; _ =&gt; NONCE &lt;/nonce&gt;
…</dd>
</dl>
<p class="last">&lt;/account&gt;
&lt;activeAccounts&gt; … ACCT <a href="#id171"><span class="problematic" id="id172">|</span></a>-&gt; (EMPTY =&gt; #if NONCE =/=Int 0 #then false #else EMPTY #fi) … &lt;/activeAccounts&gt;</p>
</dd>
<dt>rule &lt;k&gt; load “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “storage”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(STORAGE:Map) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><dl class="first docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;storage&gt; _ =&gt; STORAGE &lt;/storage&gt;
…</dd>
</dl>
<p class="last">&lt;/account&gt;</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id173"><span class="problematic" id="id174">``</span></a><a href="#id175"><span class="problematic" id="id176">`</span></a></p>
<p>Here we load the environmental information.</p>
<dl class="docutils">
<dt><a href="#id177"><span class="problematic" id="id178">``</span></a><a href="#id179"><span class="problematic" id="id180">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>rule load “env” <span class="classifier-delimiter">:</span> <span class="classifier">{ KEY</span> <span class="classifier-delimiter">:</span> <span class="classifier">((VAL:String) =&gt; #parseWord(VAL)) }</span></dt>
<dd>requires KEY in (SetItem(“currentTimestamp”) SetItem(“currentGasLimit”) SetItem(“currentNumber”) SetItem(“currentDifficulty”))</dd>
<dt>rule load “env” <span class="classifier-delimiter">:</span> <span class="classifier">{ KEY</span> <span class="classifier-delimiter">:</span> <span class="classifier">((VAL:String) =&gt; #parseHexWord(VAL)) }</span></dt>
<dd>requires KEY in (SetItem(“currentCoinbase”) SetItem(“previousHash”))</dd>
</dl>
</div></blockquote>
<dl class="last docutils">
<dt>// ———————————————————————-</dt>
<dd><p class="first">rule &lt;k&gt; load “env” : { “currentCoinbase”   : (CB:Int)     } =&gt; . … &lt;/k&gt; &lt;coinbase&gt;     _ =&gt; CB     &lt;/coinbase&gt;
rule &lt;k&gt; load “env” : { “currentDifficulty” : (DIFF:Int)   } =&gt; . … &lt;/k&gt; &lt;difficulty&gt;   _ =&gt; DIFF   &lt;/difficulty&gt;
rule &lt;k&gt; load “env” : { “currentGasLimit”   : (GLIMIT:Int) } =&gt; . … &lt;/k&gt; &lt;gasLimit&gt;     _ =&gt; GLIMIT &lt;/gasLimit&gt;
rule &lt;k&gt; load “env” : { “currentNumber”     : (NUM:Int)    } =&gt; . … &lt;/k&gt; &lt;number&gt;       _ =&gt; NUM    &lt;/number&gt;
rule &lt;k&gt; load “env” : { “previousHash”      : (HASH:Int)   } =&gt; . … &lt;/k&gt; &lt;previousHash&gt; _ =&gt; HASH   &lt;/previousHash&gt;
rule &lt;k&gt; load “env” : { “currentTimestamp”  : (TS:Int)     } =&gt; . … &lt;/k&gt; &lt;timestamp&gt;    _ =&gt; TS     &lt;/timestamp&gt;</p>
<dl class="last docutils">
<dt>rule load “exec” <span class="classifier-delimiter">:</span> <span class="classifier">{ KEY</span> <span class="classifier-delimiter">:</span> <span class="classifier">((VAL:String) =&gt; #parseWord(VAL)) }</span></dt>
<dd>requires KEY in (SetItem(“gas”) SetItem(“gasPrice”) SetItem(“value”))</dd>
<dt>rule load “exec” <span class="classifier-delimiter">:</span> <span class="classifier">{ KEY</span> <span class="classifier-delimiter">:</span> <span class="classifier">((VAL:String) =&gt; #parseHexWord(VAL)) }</span></dt>
<dd>requires KEY in (SetItem(“address”) SetItem(“caller”) SetItem(“origin”))</dd>
</dl>
</dd>
<dt>// ————————————————————————–</dt>
<dd><p class="first">rule &lt;k&gt; load “exec” : { “gasPrice” : (GPRICE:Int)   } =&gt; . … &lt;/k&gt; &lt;gasPrice&gt;  _ =&gt; GPRICE   &lt;/gasPrice&gt;
rule &lt;k&gt; load “exec” : { “gas”      : (GAVAIL:Int)   } =&gt; . … &lt;/k&gt; &lt;gas&gt;       _ =&gt; GAVAIL   &lt;/gas&gt;
rule &lt;k&gt; load “exec” : { “address”  : (ACCTTO:Int)   } =&gt; . … &lt;/k&gt; &lt;id&gt;        _ =&gt; ACCTTO   &lt;/id&gt;
rule &lt;k&gt; load “exec” : { “caller”   : (ACCTFROM:Int) } =&gt; . … &lt;/k&gt; &lt;caller&gt;    _ =&gt; ACCTFROM &lt;/caller&gt;
rule &lt;k&gt; load “exec” : { “gas”      : (GAVAIL:Int)   } =&gt; . … &lt;/k&gt; &lt;gas&gt;       _ =&gt; GAVAIL   &lt;/gas&gt;
rule &lt;k&gt; load “exec” : { “value”    : (VALUE:Int)    } =&gt; . … &lt;/k&gt; &lt;callValue&gt; _ =&gt; VALUE    &lt;/callValue&gt;
rule &lt;k&gt; load “exec” : { “origin”   : (ORIG:Int)     } =&gt; . … &lt;/k&gt; &lt;origin&gt;    _ =&gt; ORIG     &lt;/origin&gt;
rule &lt;k&gt; load “exec” : { “code”     : ((CODE:String)   =&gt; #parseByteStack(CODE)) } … &lt;/k&gt;</p>
<p class="last">rule load “exec” : { “data” : ((<a class="reference external" href="DATA:String">DATA:String</a>) =&gt; #parseByteStack(DATA)) }</p>
</dd>
<dt>// ————————————————————————</dt>
<dd>rule &lt;k&gt; load “exec” : { “data” : (<a class="reference external" href="DATA:WordStack">DATA:WordStack</a>) } =&gt; . … &lt;/k&gt; &lt;callData&gt; _ =&gt; DATA &lt;/callData&gt;
rule &lt;k&gt; load “exec” : { “code” : (CODE:WordStack) } =&gt; . … &lt;/k&gt; &lt;program&gt;  _ =&gt; #asMapOpCodes(#dasmOpCodes(CODE, SCHED)) &lt;/program&gt; &lt;programBytes&gt; _ =&gt; CODE &lt;/programBytes&gt; &lt;schedule&gt; SCHED &lt;/schedule&gt;</dd>
</dl>
</dd>
</dl>
<p><a href="#id181"><span class="problematic" id="id182">``</span></a><a href="#id183"><span class="problematic" id="id184">`</span></a></p>
<p>The <cite>“network”</cite> key allows setting the fee schedule inside the test.</p>
<dl class="docutils">
<dt><a href="#id185"><span class="problematic" id="id186">``</span></a><a href="#id187"><span class="problematic" id="id188">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>rule &lt;k&gt; load “network” <span class="classifier-delimiter">:</span> <span class="classifier">SCHEDSTRING =&gt; . … &lt;/k&gt;</span></dt>
<dd>&lt;schedule&gt; _ =&gt; #asScheduleString(SCHEDSTRING) &lt;/schedule&gt;</dd>
</dl>
<p>syntax Schedule ::= #asScheduleString ( String ) [function]</p>
</div></blockquote>
<dl class="last docutils">
<dt>// ———————————————————–</dt>
<dd>rule #asScheduleString(“EIP150”)         =&gt; EIP150
rule #asScheduleString(“EIP158”)         =&gt; EIP158
rule #asScheduleString(“Frontier”)       =&gt; FRONTIER
rule #asScheduleString(“Homestead”)      =&gt; HOMESTEAD
rule #asScheduleString(“Byzantium”)      =&gt; BYZANTIUM
rule #asScheduleString(“Constantinople”) =&gt; CONSTANTINOPLE</dd>
</dl>
</dd>
</dl>
<p><a href="#id189"><span class="problematic" id="id190">``</span></a><a href="#id191"><span class="problematic" id="id192">`</span></a></p>
<p>The <cite>“rlp”</cite> key loads the block information.</p>
<dl class="docutils">
<dt><a href="#id193"><span class="problematic" id="id194">``</span></a><a href="#id195"><span class="problematic" id="id196">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>rule load “rlp” : (VAL:String =&gt; #rlpDecode(#unparseByteStack(#parseByteStack(VAL))))
rule load “genesisRLP” : (VAL:String =&gt; #rlpDecode(#unparseByteStack(#parseByteStack(VAL))))</div></blockquote>
<dl class="last docutils">
<dt>// ——————————————————————————————–</dt>
<dd><dl class="first last docutils">
<dt>rule &lt;k&gt; load “rlp” <span class="classifier-delimiter">:</span> <span class="classifier">[ [ HP , HO , HC , HR , HT , HE , HB , HD , HI , HL , HG , HS , HX , HM , HN , .JSONList ] , BT , BU , .JSONList ]</span></dt>
<dd><blockquote class="first">
<div>=&gt; load “transaction” : BT</div></blockquote>
<p class="last">…
&lt;/k&gt;
&lt;previousHash&gt;      _ =&gt; #asWord(#parseByteStackRaw(HP)) &lt;/previousHash&gt;
&lt;ommersHash&gt;        _ =&gt; #asWord(#parseByteStackRaw(HO)) &lt;/ommersHash&gt;
&lt;coinbase&gt;          _ =&gt; #asWord(#parseByteStackRaw(HC)) &lt;/coinbase&gt;
&lt;stateRoot&gt;         _ =&gt; #asWord(#parseByteStackRaw(HR)) &lt;/stateRoot&gt;
&lt;transactionsRoot&gt;  _ =&gt; #asWord(#parseByteStackRaw(HT)) &lt;/transactionsRoot&gt;
&lt;receiptsRoot&gt;      _ =&gt; #asWord(#parseByteStackRaw(HE)) &lt;/receiptsRoot&gt;
&lt;logsBloom&gt;         _ =&gt; #parseByteStackRaw(HB)          &lt;/logsBloom&gt;
&lt;difficulty&gt;        _ =&gt; #asWord(#parseByteStackRaw(HD)) &lt;/difficulty&gt;
&lt;number&gt;            _ =&gt; #asWord(#parseByteStackRaw(HI)) &lt;/number&gt;
&lt;gasLimit&gt;          _ =&gt; #asWord(#parseByteStackRaw(HL)) &lt;/gasLimit&gt;
&lt;gasUsed&gt;           _ =&gt; #asWord(#parseByteStackRaw(HG)) &lt;/gasUsed&gt;
&lt;timestamp&gt;         _ =&gt; #asWord(#parseByteStackRaw(HS)) &lt;/timestamp&gt;
&lt;extraData&gt;         _ =&gt; #parseByteStackRaw(HX)          &lt;/extraData&gt;
&lt;mixHash&gt;           _ =&gt; #asWord(#parseByteStackRaw(HM)) &lt;/mixHash&gt;
&lt;blockNonce&gt;        _ =&gt; #asWord(#parseByteStackRaw(HN)) &lt;/blockNonce&gt;
&lt;ommerBlockHeaders&gt; _ =&gt; BU                              &lt;/ommerBlockHeaders&gt;</p>
</dd>
<dt>rule &lt;k&gt; load “genesisRLP”: [ [ HP, HO, HC, HR, HT, HE:String, HB, HD, HI, HL, HG, HS, HX, HM, HN, .JSONList ], _, _, .JSONList ] =&gt; .K … &lt;/k&gt;</dt>
<dd>&lt;blockhash&gt; .List =&gt; ListItem(#blockHeaderHash(HP, HO, HC, HR, HT, HE, HB, HD, HI, HL, HG, HS, HX, HM, HN)) ListItem(#asWord(#parseByteStackRaw(HP))) … &lt;/blockhash&gt;</dd>
<dt>rule &lt;k&gt; load “transaction” <span class="classifier-delimiter">:</span> <span class="classifier">[ [ TN , TP , TG , TT , TV , TI , TW , TR , TS ] , REST =&gt; REST ] … &lt;/k&gt;</span></dt>
<dd><p class="first">&lt;txOrder&gt;   … .List =&gt; ListItem(!ID) &lt;/txOrder&gt;
&lt;txPending&gt; … .List =&gt; ListItem(!ID) &lt;/txPending&gt;
&lt;messages&gt;</p>
<blockquote>
<div><blockquote>
<div>( .Bag</div></blockquote>
<dl class="docutils">
<dt>=&gt; &lt;message&gt;</dt>
<dd><blockquote class="first last">
<div><blockquote>
<div>&lt;msgID&gt;      !ID:Int                                 &lt;/msgID&gt;
&lt;txNonce&gt;    #asWord(#parseByteStackRaw(TN))         &lt;/txNonce&gt;
&lt;txGasPrice&gt; #asWord(#parseByteStackRaw(TP))         &lt;/txGasPrice&gt;
&lt;txGasLimit&gt; #asWord(#parseByteStackRaw(TG))         &lt;/txGasLimit&gt;
&lt;to&gt;         #asAccount(#parseByteStackRaw(TT))      &lt;/to&gt;
&lt;value&gt;      #asWord(#parseByteStackRaw(TV))         &lt;/value&gt;
&lt;v&gt;          #asWord(#parseByteStackRaw(TW))         &lt;/v&gt;
&lt;r&gt;          #padToWidth(32, #parseByteStackRaw(TR)) &lt;/r&gt;
&lt;s&gt;          #padToWidth(32, #parseByteStackRaw(TS)) &lt;/s&gt;
&lt;data&gt;       #parseByteStackRaw(TI)                  &lt;/data&gt;</div></blockquote>
<p>&lt;/message&gt;</p>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
<p class="last">&lt;/messages&gt;</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id197"><span class="problematic" id="id198">``</span></a><a href="#id199"><span class="problematic" id="id200">`</span></a></p>
<p>### Checking State</p>
<ul class="simple">
<li><cite>check_</cite> checks if an account/transaction appears in the world-state as stated.</li>
</ul>
<dl class="docutils">
<dt><a href="#id201"><span class="problematic" id="id202">``</span></a><a href="#id203"><span class="problematic" id="id204">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>syntax EthereumCommand ::= “check” JSON</div></blockquote>
<dl class="last docutils">
<dt>// —————————————</dt>
<dd><p class="first">rule #exception ~&gt; check J:JSON =&gt; check J ~&gt; #exception
rule check DATA : { .JSONList } =&gt; . requires DATA =/=String “transactions”
rule check DATA : { (KEY:String) : VALUE , REST } =&gt; check DATA : { KEY : VALUE } ~&gt; check DATA : { REST }</p>
<blockquote>
<div>requires REST =/=K .JSONList andBool notBool DATA in (SetItem(“callcreates”) SetItem(“transactions”))</div></blockquote>
<p>rule check DATA : [ .JSONList ] =&gt; . requires DATA =/=String “ommerHeaders”
rule check DATA : [ { TEST } , REST ] =&gt; check DATA : { TEST } ~&gt; check DATA : [ REST ] requires DATA =/=String “transactions”</p>
<dl class="docutils">
<dt>rule check (KEY:String) <span class="classifier-delimiter">:</span> <span class="classifier">{ JS:JSONList =&gt; #sortJSONList(JS) }</span></dt>
<dd>requires KEY in (SetItem(“callcreates”)) andBool notBool #isSorted(JS)</dd>
</dl>
<p class="last">rule check TESTID : { “post” : POST } =&gt; check “account” : POST ~&gt; failure TESTID
rule check “account” : { ACCTID: { KEY : VALUE , REST } } =&gt; check “account” : { ACCTID : { KEY : VALUE } } ~&gt; check “account” : { ACCTID : { REST } } requires REST =/=K .JSONList</p>
</dd>
<dt>// ———————————————————————————————————————————————————————————–</dt>
<dd><p class="first">rule check “account” : { ((ACCTID:String) =&gt; #parseAddr(ACCTID)) : ACCT }
rule check “account” : { (ACCT:Int) : { “balance” : ((VAL:String)         =&gt; #parseWord(VAL)) } }
rule check “account” : { (ACCT:Int) : { “nonce”   : ((VAL:String)         =&gt; #parseWord(VAL)) } }
rule check “account” : { (ACCT:Int) : { “code”    : ((CODE:String)        =&gt; #parseByteStack(CODE)) } }
rule check “account” : { (ACCT:Int) : { “storage” : ({ STORAGE:JSONList } =&gt; #parseMap({ STORAGE })) } }</p>
<dl class="last docutils">
<dt>rule &lt;k&gt; check “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “balance”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(BAL:Int) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><dl class="first docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;balance&gt; BAL &lt;/balance&gt;
…</dd>
</dl>
<p class="last">&lt;/account&gt;</p>
</dd>
<dt>rule &lt;k&gt; check “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “nonce”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(NONCE:Int) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><dl class="first docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;nonce&gt; NONCE &lt;/nonce&gt;
…</dd>
</dl>
<p class="last">&lt;/account&gt;</p>
</dd>
<dt>rule &lt;k&gt; check “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “storage”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(STORAGE:Map) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;storage&gt; ACCTSTORAGE &lt;/storage&gt;
…</dd>
</dl>
<p>&lt;/account&gt;</p>
</div></blockquote>
<p class="last">requires #removeZeros(ACCTSTORAGE) ==K STORAGE</p>
</dd>
<dt>rule &lt;k&gt; check “account” <span class="classifier-delimiter">:</span> <span class="classifier">{ ACCT</span> <span class="classifier-delimiter">:</span> <span class="classifier">{ “code”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(CODE:WordStack) } } =&gt; . … &lt;/k&gt;</span></dt>
<dd><dl class="first docutils">
<dt>&lt;account&gt;</dt>
<dd>&lt;acctID&gt; ACCT &lt;/acctID&gt;
&lt;code&gt; CODE &lt;/code&gt;
…</dd>
</dl>
<p class="last">&lt;/account&gt;</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id205"><span class="problematic" id="id206">``</span></a><a href="#id207"><span class="problematic" id="id208">`</span></a></p>
<p>Here we check the other post-conditions associated with an EVM test.</p>
<dl class="docutils">
<dt><a href="#id209"><span class="problematic" id="id210">``</span></a><a href="#id211"><span class="problematic" id="id212">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>rule check TESTID : { “out” : OUT } =&gt; check “out” : OUT ~&gt; failure TESTID</div></blockquote>
<dl class="last docutils">
<dt>// ————————————————————————–</dt>
<dd><p class="first">rule check “out” : ((OUT:String) =&gt; #parseByteStack(OUT))
rule &lt;k&gt; check “out” : OUT =&gt; . … &lt;/k&gt; &lt;output&gt; OUT &lt;/output&gt;</p>
<p class="last">rule check TESTID : { “logs” : LOGS } =&gt; check “logs” : LOGS ~&gt; failure TESTID</p>
</dd>
<dt>// ——————————————————————————</dt>
<dd><p class="first">rule &lt;k&gt; check “logs” : HASH:String =&gt; . … &lt;/k&gt; &lt;log&gt; SL &lt;/log&gt; requires #parseHexBytes(Keccak256(#rlpEncodeLogs(SL))) ==K #parseByteStack(HASH)</p>
<dl class="last docutils">
<dt>syntax String ::= #rlpEncodeLogs(List)        [function]</dt>
<dd><div class="first last line-block">
<div class="line">#rlpEncodeLogsAux(List)     [function]</div>
<div class="line">#rlpEncodeTopics(WordStack) [function]</div>
</div>
</dd>
</dl>
</dd>
<dt>// ——————————————————–</dt>
<dd><p class="first">rule #rlpEncodeLogs(SL) =&gt; #rlpEncodeLength(#rlpEncodeLogsAux(SL), 192)
rule #rlpEncodeLogsAux(ListItem({ ACCT | TOPICS | DATA }) SL) =&gt; #rlpEncodeLength(#rlpEncodeBytes(ACCT, 20) +String #rlpEncodeLength(#rlpEncodeTopics(TOPICS), 192) +String #rlpEncodeString(#unparseByteStack(DATA)), 192) +String #rlpEncodeLogsAux(SL)
rule #rlpEncodeLogsAux(.List) =&gt; “”
rule #rlpEncodeTopics(TOPIC : TOPICS) =&gt; #rlpEncodeBytes(TOPIC, 32) +String #rlpEncodeTopics(TOPICS)
rule #rlpEncodeTopics(.WordStack) =&gt; “”</p>
<p class="last">rule check TESTID : { “gas” : GLEFT } =&gt; check “gas” : GLEFT ~&gt; failure TESTID</p>
</dd>
<dt>// ——————————————————————————</dt>
<dd><p class="first">rule check “gas” : ((GLEFT:String) =&gt; #parseWord(GLEFT))
rule &lt;k&gt; check “gas” : GLEFT =&gt; . … &lt;/k&gt; &lt;gas&gt; GLEFT &lt;/gas&gt;</p>
<p class="last">rule check TESTID : { “callcreates” : CCREATES } =&gt; check “callcreates” : CCREATES ~&gt; failure TESTID</p>
</dd>
<dt>// —————————————————————————————————-</dt>
<dd><dl class="first docutils">
<dt>rule check “callcreates” <span class="classifier-delimiter">:</span> <span class="classifier">{ (“data”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(<a class="reference external" href="DATA:String">DATA:String</a>)) , (“destination”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(ACCTTO:String)) , (“gasLimit”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(GLIMIT:String)) , (“value”</span> <span class="classifier-delimiter">:</span> <span class="classifier">(VAL:String)) , .JSONList }</span></dt>
<dd>=&gt; check “callcreates” : { #parseAddr(ACCTTO) | #parseWord(GLIMIT) | #parseWord(VAL) | #parseByteStack(DATA) }</dd>
</dl>
<p>rule &lt;k&gt; check “callcreates” : C:Call =&gt; . … &lt;/k&gt; &lt;callLog&gt; CL &lt;/callLog&gt; requires C in CL</p>
<p class="last">rule check TESTID : { “blockHeader” : BLOCKHEADER } =&gt; check “blockHeader” : BLOCKHEADER ~&gt; failure TESTID</p>
</dd>
<dt>// ———————————————————————————————————-</dt>
<dd><p class="first">rule check “blockHeader” : { KEY : VALUE , REST } =&gt; check “blockHeader” : { KEY : VALUE } ~&gt; check “blockHeader” : { REST } requires REST =/=K .JSONList</p>
<p>rule check “blockHeader” : { KEY : (VALUE:String =&gt; #parseByteStack(VALUE)) }</p>
<dl class="docutils">
<dt>rule check “blockHeader” <span class="classifier-delimiter">:</span> <span class="classifier">{ KEY</span> <span class="classifier-delimiter">:</span> <span class="classifier">(VALUE:WordStack =&gt; #asWord(VALUE)) }</span></dt>
<dd><dl class="first last docutils">
<dt>requires KEY in ( SetItem(“coinbase”) SetItem(“difficulty”) SetItem(“gasLimit”) SetItem(“gasUsed”)</dt>
<dd><blockquote class="first">
<div>SetItem(“mixHash”) SetItem(“nonce”) SetItem(“number”) SetItem(“parentHash”)
SetItem(“receiptTrie”) SetItem(“stateRoot”) SetItem(“timestamp”)
SetItem(“transactionsTrie”) SetItem(“uncleHash”)</div></blockquote>
<p class="last">)</p>
</dd>
</dl>
</dd>
</dl>
<p>rule &lt;k&gt; check “blockHeader” : { “bloom”            : VALUE } =&gt; . … &lt;/k&gt; &lt;logsBloom&gt;        VALUE &lt;/logsBloom&gt;
rule &lt;k&gt; check “blockHeader” : { “coinbase”         : VALUE } =&gt; . … &lt;/k&gt; &lt;coinbase&gt;         VALUE &lt;/coinbase&gt;
rule &lt;k&gt; check “blockHeader” : { “difficulty”       : VALUE } =&gt; . … &lt;/k&gt; &lt;difficulty&gt;       VALUE &lt;/difficulty&gt;
rule &lt;k&gt; check “blockHeader” : { “extraData”        : VALUE } =&gt; . … &lt;/k&gt; &lt;extraData&gt;        VALUE &lt;/extraData&gt;
rule &lt;k&gt; check “blockHeader” : { “gasLimit”         : VALUE } =&gt; . … &lt;/k&gt; &lt;gasLimit&gt;         VALUE &lt;/gasLimit&gt;
rule &lt;k&gt; check “blockHeader” : { “gasUsed”          : VALUE } =&gt; . … &lt;/k&gt; &lt;gasUsed&gt;          VALUE &lt;/gasUsed&gt;
rule &lt;k&gt; check “blockHeader” : { “mixHash”          : VALUE } =&gt; . … &lt;/k&gt; &lt;mixHash&gt;          VALUE &lt;/mixHash&gt;
rule &lt;k&gt; check “blockHeader” : { “nonce”            : VALUE } =&gt; . … &lt;/k&gt; &lt;blockNonce&gt;       VALUE &lt;/blockNonce&gt;
rule &lt;k&gt; check “blockHeader” : { “number”           : VALUE } =&gt; . … &lt;/k&gt; &lt;number&gt;           VALUE &lt;/number&gt;
rule &lt;k&gt; check “blockHeader” : { “parentHash”       : VALUE } =&gt; . … &lt;/k&gt; &lt;previousHash&gt;     VALUE &lt;/previousHash&gt;
rule &lt;k&gt; check “blockHeader” : { “receiptTrie”      : VALUE } =&gt; . … &lt;/k&gt; &lt;receiptsRoot&gt;     VALUE &lt;/receiptsRoot&gt;
rule &lt;k&gt; check “blockHeader” : { “stateRoot”        : VALUE } =&gt; . … &lt;/k&gt; &lt;stateRoot&gt;        VALUE &lt;/stateRoot&gt;
rule &lt;k&gt; check “blockHeader” : { “timestamp”        : VALUE } =&gt; . … &lt;/k&gt; &lt;timestamp&gt;        VALUE &lt;/timestamp&gt;
rule &lt;k&gt; check “blockHeader” : { “transactionsTrie” : VALUE } =&gt; . … &lt;/k&gt; &lt;transactionsRoot&gt; VALUE &lt;/transactionsRoot&gt;
rule &lt;k&gt; check “blockHeader” : { “uncleHash”        : VALUE } =&gt; . … &lt;/k&gt; &lt;ommersHash&gt;       VALUE &lt;/ommersHash&gt;</p>
<dl class="docutils">
<dt>rule &lt;k&gt; check “blockHeader” <span class="classifier-delimiter">:</span> <span class="classifier">{ “hash”: HASH:WordStack } =&gt; . …&lt;/k&gt;</span></dt>
<dd><blockquote class="first">
<div>&lt;previousHash&gt;     HP &lt;/previousHash&gt;
&lt;ommersHash&gt;       HO &lt;/ommersHash&gt;
&lt;coinbase&gt;         HC &lt;/coinbase&gt;
&lt;stateRoot&gt;        HR &lt;/stateRoot&gt;
&lt;transactionsRoot&gt; HT &lt;/transactionsRoot&gt;
&lt;receiptsRoot&gt;     HE &lt;/receiptsRoot&gt;
&lt;logsBloom&gt;        HB &lt;/logsBloom&gt;
&lt;difficulty&gt;       HD &lt;/difficulty&gt;
&lt;number&gt;           HI &lt;/number&gt;
&lt;gasLimit&gt;         HL &lt;/gasLimit&gt;
&lt;gasUsed&gt;          HG &lt;/gasUsed&gt;
&lt;timestamp&gt;        HS &lt;/timestamp&gt;
&lt;extraData&gt;        HX &lt;/extraData&gt;
&lt;mixHash&gt;          HM &lt;/mixHash&gt;
&lt;blockNonce&gt;       HN &lt;/blockNonce&gt;</div></blockquote>
<p class="last">requires #blockHeaderHash(HP, HO, HC, HR, HT, HE, HB, HD, HI, HL, HG, HS, HX, HM, HN) ==Int #asWord(HASH)</p>
</dd>
</dl>
<p class="last">rule check TESTID : { “genesisBlockHeader” : BLOCKHEADER } =&gt; check “genesisBlockHeader” : BLOCKHEADER ~&gt; failure TESTID</p>
</dd>
<dt>// ————————————————————————————————————————</dt>
<dd><p class="first">rule check “genesisBlockHeader” : { KEY : VALUE , REST } =&gt; check “genesisBlockHeader” : { KEY : VALUE } ~&gt; check “genesisBlockHeader” : { REST } requires REST =/=K .JSONList
rule check “genesisBlockHeader” : { KEY : VALUE } =&gt; .K requires KEY =/=String “hash”</p>
<p>rule check “genesisBlockHeader” : { “hash”: (HASH:String =&gt; #asWord(#parseByteStack(HASH))) }
rule &lt;k&gt; check “genesisBlockHeader” : { “hash”: HASH } =&gt; . … &lt;/k&gt;</p>
<blockquote>
<div>&lt;blockhash&gt; … ListItem(HASH) ListItem(_) &lt;/blockhash&gt;</div></blockquote>
<p class="last">rule check TESTID : { “transactions” : TRANSACTIONS } =&gt; check “transactions” : TRANSACTIONS ~&gt; failure TESTID</p>
</dd>
<dt>// ————————————————————————————————————–</dt>
<dd><p class="first">rule &lt;k&gt; check “transactions” : [ .JSONList ] =&gt; . … &lt;/k&gt; &lt;txOrder&gt; .List &lt;/txOrder&gt;
rule check “transactions” : [ TRANSACTION , REST ] =&gt; check “transactions” : TRANSACTION ~&gt; check “transactions” : [ REST ]
rule check “transactions” : { KEY : VALUE , REST } =&gt; check “transactions” : (KEY : VALUE) ~&gt; check “transactions” : { REST }
rule &lt;k&gt; check “transactions” : { .JSONList } =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(_) =&gt; .List … &lt;/txOrder&gt;</p>
<p>rule check “transactions” : (KEY : (VALUE:String =&gt; #parseByteStack(VALUE)))</p>
<p>rule check “transactions” : (KEY : (VALUE:WordStack =&gt; #padToWidth(32, VALUE))) requires (KEY ==String “r” orBool KEY ==String “s”) andBool #sizeWordStack(VALUE) &lt;Int 32</p>
<p>rule check “transactions” : (“to” : (VALUE:WordStack =&gt; #asAccount(VALUE)))</p>
<dl class="docutils">
<dt>rule check “transactions” <span class="classifier-delimiter">:</span> <span class="classifier">(KEY</span> <span class="classifier-delimiter">:</span> <span class="classifier">(VALUE:WordStack =&gt; #asWord(VALUE)))</span></dt>
<dd><dl class="first last docutils">
<dt>requires KEY in ( SetItem(“gasLimit”) SetItem(“gasPrice”) SetItem(“nonce”)</dt>
<dd><blockquote class="first">
<div>SetItem(“v”) SetItem(“value”)</div></blockquote>
<p class="last">)</p>
</dd>
</dl>
</dd>
</dl>
<p class="last">rule &lt;k&gt; check “transactions” : (“data”     : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;data&gt;       VALUE &lt;/data&gt;       … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“gasLimit” : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;txGasLimit&gt; VALUE &lt;/txGasLimit&gt; … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“gasPrice” : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;txGasPrice&gt; VALUE &lt;/txGasPrice&gt; … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“nonce”    : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;txNonce&gt;    VALUE &lt;/txNonce&gt;    … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“r”        : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;r&gt;          VALUE &lt;/r&gt;          … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“s”        : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;s&gt;          VALUE &lt;/s&gt;          … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“to”       : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;to&gt;         VALUE &lt;/to&gt;         … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“v”        : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;v&gt;          VALUE &lt;/v&gt;          … &lt;/message&gt;
rule &lt;k&gt; check “transactions” : (“value”    : VALUE) =&gt; . … &lt;/k&gt; &lt;txOrder&gt; ListItem(TXID) … &lt;/txOrder&gt; &lt;message&gt; &lt;msgID&gt; TXID &lt;/msgID&gt; &lt;value&gt;      VALUE &lt;/value&gt;      … &lt;/message&gt;</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id213"><span class="problematic" id="id214">``</span></a><a href="#id215"><span class="problematic" id="id216">`</span></a></p>
<p>TODO: case with nonzero ommers.</p>
<dl class="docutils">
<dt><a href="#id217"><span class="problematic" id="id218">``</span></a><a href="#id219"><span class="problematic" id="id220">`</span></a>{.k .uiuck .rvk}</dt>
<dd><blockquote class="first">
<div>rule check TESTID : { “uncleHeaders” : OMMERS } =&gt; check “ommerHeaders” : OMMERS ~&gt; failure TESTID</div></blockquote>
<dl class="last docutils">
<dt>// ————————————————————————————————–</dt>
<dd>rule &lt;k&gt; check “ommerHeaders” : [ .JSONList ] =&gt; . … &lt;/k&gt; &lt;ommerBlockHeaders&gt; [ .JSONList ] &lt;/ommerBlockHeaders&gt;</dd>
</dl>
</dd>
</dl>
<p>endmodule
<a href="#id221"><span class="problematic" id="id222">``</span></a><a href="#id223"><span class="problematic" id="id224">`</span></a></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../verification/" class="btn btn-neutral float-right" title="KEVM Verification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../evm/" class="btn btn-neutral" title="EVM Execution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, The KEVM Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>